# https://wiki.debian.org/AptCacherNg
- name: AptCacherNg Client
  ansible.builtin.apt:
    pkg:
      - squid-deb-proxy-client
      - auto-apt-proxy
    update_cache: true
  become: true
  when: configuration == "automatic"
  notify:
  - Fix, 403 CONNECT denied error
  - Update cache


- name: Apt.conf on Vagrant
  ansible.builtin.lineinfile:
    path: /etc/apt/apt.conf
    regexp: '^Acquire::http::Proxy'
    line: 'Acquire::http::Proxy "http://{{ aptcacherng_ip }}:3142";'
    create: true
    mode: "0600"
  when: ansible_user_id == 'vagrant' and ansible_virtualization_role == 'guest'
  become: true
  notify:
  - Fix, 403 CONNECT denied error
  - Update cache

- name: Force flush handlers
  ansible.builtin.meta: flush_handlers